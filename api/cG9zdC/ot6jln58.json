{"title":"跨域","date":"2014-04-18T00:13:01.000Z","slug":"跨域","comments":true,"updated":"2019-03-26T01:51:13.290Z","content":"<p>15 ajax 封装<br>16 angu<br>17 react<br>18 项目 小程序</p>\n<h1 id=\"三种方法：\">三种方法：<a href=\"post/跨域#三种方法：\"></a></h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cls </span><br><span class=\"line\">(&quot;Access-Control-Allow-Origin&quot;:&quot;*&quot;）允许所有跨域访问，所以跨域访问成功。</span><br><span class=\"line\">无论访问是文档，还是js文件都可以实现跨域</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jsonp</span><br><span class=\"line\">jsonp原理 ： 动态添加&lt;script&gt;标签来调用服务器提供的js脚本</span><br><span class=\"line\"></span><br><span class=\"line\">---jsonp 与 ajax 有什么区别 ---</span><br><span class=\"line\"></span><br><span class=\"line\">ajax的核心是 ： 通过XmlHttpRequest获取非本页内容，</span><br><span class=\"line\">jsonp的核心 ： 动态添加&lt;script&gt;标签</span><br><span class=\"line\"></span><br><span class=\"line\">---为什么只能用get请求---</span><br><span class=\"line\">·动态的创建了一个全局方法，</span><br><span class=\"line\">·并且动态生成script标签，将script标签的src属性变为（接口地址?callback=动态生成方法的方法名）请求数据</span><br><span class=\"line\">·后台返回来的是一串数据用callback接收，返给浏览器，这样生成了假象的ajax，因此只能get</span><br></pre></td></tr></table></figure>\n<h3 id=\"HTML里面放这个\">HTML里面放这个<a href=\"post/跨域#HTML里面放这个\"></a></h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=<span class=\"string\">\"en\"</span>&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=<span class=\"string\">\"UTF-8\"</span>&gt;</span><br><span class=\"line\">    &lt;meta name=<span class=\"string\">\"viewport\"</span> content=<span class=\"string\">\"width=device-width, initial-scale=1.0\"</span>&gt;</span><br><span class=\"line\">    &lt;meta http-equiv=<span class=\"string\">\"X-UA-Compatible\"</span> content=<span class=\"string\">\"ie=edge\"</span>&gt;</span><br><span class=\"line\">    &lt;title&gt;Document&lt;<span class=\"regexp\">/title&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    <span class=\"keyword\">this</span> is index  server</span><br><span class=\"line\">    &lt;script&gt;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">jsonpCallback</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(data,<span class=\"string\">'data'</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> defaultStatus = &#123;<span class=\"attr\">callback</span>:<span class=\"string\">\"jsonpCallback\"</span>&#125;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">format</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> temp = <span class=\"string\">\"\"</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> params <span class=\"keyword\">in</span> data)&#123;</span><br><span class=\"line\">                temp +=  <span class=\"string\">`<span class=\"subst\">$&#123;<span class=\"built_in\">encodeURIComponent</span>(params)&#125;</span>=<span class=\"subst\">$&#123;<span class=\"built_in\">encodeURIComponent</span>(data[params])&#125;</span>&amp;`</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> temp</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">jsonp</span>(<span class=\"params\">url,data,opt=defaultStatus</span>)</span>&#123;</span><br><span class=\"line\">            oScript = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'script'</span>)</span><br><span class=\"line\">            <span class=\"keyword\">let</span> hasCallback = url.indexOf(<span class=\"string\">\"callback\"</span>)</span><br><span class=\"line\">            url += url.indexOf(<span class=\"string\">\"?\"</span>) == <span class=\"number\">-1</span> ? <span class=\"string\">\"?\"</span> + format(data) : format(data) </span><br><span class=\"line\">            <span class=\"keyword\">if</span>(hasCallback == <span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">                url += <span class=\"string\">`callback=<span class=\"subst\">$&#123;opt.callback&#125;</span>`</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            oScript.setAttribute(<span class=\"string\">'src'</span>,url)</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"built_in\">document</span>.body.appendChild(oScript)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> url = <span class=\"string\">\"http://localhost:3000\"</span> </span><br><span class=\"line\">        <span class=\"keyword\">let</span> data = &#123;</span><br><span class=\"line\">            username:<span class=\"string\">'yl'</span>,</span><br><span class=\"line\">            password:<span class=\"string\">'666'</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> opt = &#123;</span><br><span class=\"line\">            callback:<span class=\"string\">'jsonpCallback'</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        jsonp(url,data,opt)</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>body&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/html&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 此内容 放js 这是后台 用gulp 写的</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs'</span>) </span><br><span class=\"line\"><span class=\"keyword\">const</span> gulp = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp'</span>) </span><br><span class=\"line\"><span class=\"keyword\">const</span> webserver = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-webserver'</span>) </span><br><span class=\"line\"></span><br><span class=\"line\">gulp.task(<span class=\"string\">'api'</span>,()=&gt;&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> gulp.src(<span class=\"string\">'.'</span>)</span><br><span class=\"line\">    .pipe(webserver(&#123;</span><br><span class=\"line\">        host:<span class=\"string\">'localhost'</span>,</span><br><span class=\"line\">        port:<span class=\"number\">8000</span>,</span><br><span class=\"line\">        middleware:<span class=\"function\">(<span class=\"params\">req,res</span>)=&gt;</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> indexPage = fs.readFileSync(<span class=\"string\">\"./index.html\"</span>);</span><br><span class=\"line\">            res.end(indexPage)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;))</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">gulp.task(<span class=\"string\">'default'</span>,[<span class=\"string\">'api'</span>])</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">降域 （cookie 和 ifrema）主域必须相同</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">--为什么[会]跨域</span><br><span class=\"line\">∵ 不同服务器之间访问时，会出现跨域。</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---为什么[要]跨域，</span><br><span class=\"line\">∵ 同源策略</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">----为什么有同源策略</span><br><span class=\"line\">∵ 为了保护数据，防止黑客入侵，浏览器的保护机制。</span><br></pre></td></tr></table></figure>\n<h2 id=\"最后补充小知识时间到了\">最后补充小知识时间到了<a href=\"post/跨域#最后补充小知识时间到了\"></a></h2><h3 id=\"JavaScript实现异步编程的方法\">JavaScript实现异步编程的方法<a href=\"post/跨域#JavaScript实现异步编程的方法\"></a></h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">回调函数</span><br><span class=\"line\"></span><br><span class=\"line\">事件监听</span><br><span class=\"line\"></span><br><span class=\"line\">发布/订阅</span><br><span class=\"line\"></span><br><span class=\"line\">Promises对象</span><br><span class=\"line\"></span><br><span class=\"line\">Async函数</span><br></pre></td></tr></table></figure>\n","prev":{"title":"排序","slug":"sort"},"next":{"title":"安雯","slug":"hello-world"},"link":"https://annwvn.github.io/yangliu.github.io/post/跨域/","toc":[{"title":"三种方法：","id":"三种方法：","index":"1","children":[{"title":"最后补充小知识时间到了","id":"最后补充小知识时间到了","index":"1.1","children":[{"title":"JavaScript实现异步编程的方法","id":"JavaScript实现异步编程的方法","index":"1.1.1"}]}]}]}